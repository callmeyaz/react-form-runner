"use strict";var t=require("react"),e=require("mutation-tracker"),r=require("lodash-es/forEach"),i=require("lodash-es/map"),a=require("lodash-es/some"),s=require("lodash-es/isArray"),u=require("lodash-es/isObject");function o(t,e,r,i){return new(r||(r=Promise))((function(a,s){function u(t){try{c(i.next(t))}catch(t){s(t)}}function o(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(u,o)}c((i=i.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class c{_touchedStateTracker;_dirtyStateTracker;_errorStateTracker;get touchedStateTracker(){return this._touchedStateTracker}get dirtyStateTracker(){return this._dirtyStateTracker}get errorStateTracker(){return this._errorStateTracker}constructor(t,r){this._touchedStateTracker=e.MutationTracker(t,{defaultValue:!1,initialMutation:{mutatedAttributes:r?.initiallyTouched,mutatedValue:!0}}),this._dirtyStateTracker=e.MutationTracker(t,{defaultValue:!1,initialMutation:{mutatedAttributes:r?.initiallyDirty,mutatedValue:!0}}),this._errorStateTracker=e.MutationTracker(t,{defaultValue:[]})}}class n{validator;_stateTrackers;_errorFlatList=[];constructor(t,e,r){this.validator=t,this._stateTrackers=new c(e,r)}get errorFlatList(){return this._errorFlatList}get errors(){return this._stateTrackers.errorStateTracker.state||{}}get touched(){return this._stateTrackers.touchedStateTracker.state||{}}get dirty(){return this._stateTrackers.dirtyStateTracker.state||{}}setErrorFlatList(t){this._errorFlatList=t}getFieldTouched(t){return this._stateTrackers.touchedStateTracker.getMutatedByAttributeName(t)}setFieldTouched(t,e){this._stateTrackers.touchedStateTracker.setMutatedByAttributeName(t,e)}setFieldsTouched(t,e){this._stateTrackers.touchedStateTracker.setMutatedByAttributeNames(t,e)}setTouchedAll(t){this._stateTrackers.touchedStateTracker.setAll(t)}getFieldDirty(t){return this._stateTrackers.dirtyStateTracker.getMutatedByAttributeName(t)}setFieldDirty(t,e){this._stateTrackers.dirtyStateTracker.setMutatedByAttributeName(t,e)}setFieldsDirty(t,e){this._stateTrackers.dirtyStateTracker.setMutatedByAttributeNames(t,e)}setDirtyAll(t){this._stateTrackers.dirtyStateTracker.setAll(t)}getFieldErrors(t){var e=this._stateTrackers.errorStateTracker.getMutatedByAttributeName(t);return i(e,(t=>t))}getFieldValid(t){return(this._stateTrackers.errorStateTracker.getMutatedByAttributeName(t).length??0)<=0}setErrorsAll(t){this.setErrorFlatList(t),this._stateTrackers.errorStateTracker.clear();var e=Object.groupBy(t,(({key:t})=>t));r(e,((t,e)=>{var r=t?.map((t=>t.message))||[];this._stateTrackers.errorStateTracker.setMutatedByAttributeName(r,e)}))}isFormDirty(){return a(function(t,e){const r=[];return function t(e,i="",a="."){for(const s in e)if(e.hasOwnProperty(s)){const o=i?`${i}.${s}`:s;u(e[s])&&null!==e[s]?t(e[s],o,a):r.push({key:o,value:e[s]})}}(t,"",e),r}(this._stateTrackers.dirtyStateTracker.state,"."),(t=>t.value))}isFormValid(){return!this.errorFlatList.length}getFieldState(t,e,r){var i=this._stateTrackers.errorStateTracker.getMutatedByAttributeName(t);return{name:t,currentValue:e,previousValue:r,touched:this._stateTrackers.touchedStateTracker.getMutatedByAttributeName(t),dirty:this._stateTrackers.dirtyStateTracker.getMutatedByAttributeName(t),isValid:!!i.length,errors:i}}validateAsync(t){return this.validator.validate(t).then((t=>(this.setErrorsAll(t),this.isFormValid())))}}function l(e,r,i){const a=t.useRef(new n(e,r,i)).current,[,s]=t.useState(0);function u(){s((t=>t+1))}return{errorFlatList:a.errorFlatList,errors:a.errors,touched:a.touched,dirty:a.dirty,getFieldState:function(t,e,r){return a.getFieldState(t,e,r)},getFieldTouched:function(t){return a.getFieldTouched(t)},setFieldTouched:function(t,e){a.setFieldTouched(t,e),u()},setFieldsTouched:function(t,e){a.setFieldsTouched(t,e),u()},setTouchedAll:function(t){a.setTouchedAll(t),u()},getFieldDirty:function(t){return a.getFieldDirty(t)},setFieldDirty:function(t,e){a.setFieldDirty(t,e),u()},setFieldsDirty:function(t,e){a.setFieldsDirty(t,e),u()},setDirtyAll:function(t){a.setDirtyAll(t),u()},getFieldValid:function(t){return a.getFieldValid(t)},getFieldErrors:function(t){return a.getFieldErrors(t)},setErrorsAll:function(t){a.setErrorsAll(t),u()},isFormDirty:function(){return a.isFormDirty()},isFormValid:function(){return a.isFormValid()},validateAsync:a.validateAsync}}function d(e,r,i){const[a,s]=t.useState(!1),{errorFlatList:u,errors:c,touched:n,dirty:d,getFieldTouched:h,setFieldTouched:T,setFieldsTouched:y,setTouchedAll:F,getFieldDirty:k,setFieldDirty:f,setFieldsDirty:g,setDirtyAll:S,getFieldValid:A,getFieldErrors:m,setErrorsAll:_,getFieldState:D,isFormDirty:p,isFormValid:b,validateAsync:v}=l(e,r,i);function M(){var t=!1;return(()=>{o(this,void 0,void 0,(function*(){return yield v(r).then((e=>t=e)).catch((()=>t=!1))}))})(),t}return t.useEffect((()=>{M()}),[]),{errorFlatList:u,errors:c,touched:n,dirty:d,isSubmitting:a,isFormDirty:p,isFormValid:b,validateAsync:v,validate:M,setIsSubmitting:function(t){s(t)},getFieldState:D,getFieldTouched:h,setFieldTouched:T,setFieldsTouched:y,setTouchedAll:F,getFieldDirty:k,setFieldDirty:f,setFieldsDirty:g,setDirtyAll:S,getFieldValid:A,getFieldErrors:m}}const h=d;exports.deepFreeze=function t(e){Object.freeze(e);for(const r in e)u(e[r]||s(e[r]))&&t(e[r]);return e},exports.flattenObject=function(t,e){return function t(e,r="",i="."){const a={};for(const s in e)if(e.hasOwnProperty(s)){const o=r?r+i+s:s;u(e[s])&&null!==e[s]?Object.assign(a,t(e[s],o,i)):a[o]=e[s]}return a}(t,"",e)},exports.flattenObjectToArray=function(t,e){const r=[];return function t(e,i="",a="."){for(const s in e)if(e.hasOwnProperty(s)){const o=i?`${i}.${s}`:s;u(e[s])&&null!==e[s]?t(e[s],o,a):r.push({key:o,value:e[s]})}}(t,"",e),r},exports.getDeep=function(t,r){return e.getAttributeMutation(t,r)},exports.setDeep=function(t,r,i){return e.setAttributeMutated(t,r,i)},exports.useFormFieldState=l,exports.useFormValidation=d,exports.useMabel=h;
//# sourceMappingURL=index.js.map
