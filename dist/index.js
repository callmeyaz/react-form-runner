"use strict";var t=require("react"),e=require("lodash-es/forEach"),r=require("lodash-es/map"),i=require("lodash-es/some"),s=require("mutation-tracker"),a=require("lodash-es");function u(t,e,r,i){return new(r||(r=Promise))((function(s,a){function u(t){try{c(i.next(t))}catch(t){a(t)}}function o(t){try{c(i.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(u,o)}c((i=i.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class o{get touchedStateTracker(){return this._touchedStateTracker}get dirtyStateTracker(){return this._dirtyStateTracker}get errorStateTracker(){return this._errorStateTracker}constructor(t,e){this._touchedStateTracker=s.MutationTracker(t,{defaultValue:!1,initialMutation:{mutatedAttributes:null==e?void 0:e.initiallyTouched,mutatedValue:!0}}),this._dirtyStateTracker=s.MutationTracker(t,{defaultValue:!1,initialMutation:{mutatedAttributes:null==e?void 0:e.initiallyDirty,mutatedValue:!0}}),this._errorStateTracker=s.MutationTracker(t,{defaultValue:[]})}}function c(t,e){const r=[];return function t(e,i="",s="."){for(const u in e)if(e.hasOwnProperty(u)){const o=i?`${i}.${u}`:u;a.isObject(e[u])&&null!==e[u]?t(e[u],o,s):r.push({key:o,value:e[u]})}}(t,"",e),r}class n{constructor(t,e){this._errorFlatList=[],this._stateTrackers=new o(t,e)}get errorFlatList(){return this._errorFlatList}get errors(){return this._stateTrackers.errorStateTracker.state||{}}get touched(){return this._stateTrackers.errorStateTracker.state||{}}get dirty(){return this._stateTrackers.errorStateTracker.state||{}}setErrorFlatList(t){this._errorFlatList=t}getFieldTouched(t){return this._stateTrackers.touchedStateTracker.getMutatedByAttributeName(t)}setFieldTouched(t,e){this._stateTrackers.touchedStateTracker.setMutatedByAttributeName(t,e)}setFieldsTouched(t,e){this._stateTrackers.touchedStateTracker.setMutatedByAttributeNames(t,e)}setTouchedAll(t){this._stateTrackers.touchedStateTracker.setAll(t)}getFieldDirty(t){return this._stateTrackers.dirtyStateTracker.getMutatedByAttributeName(t)}setFieldDirty(t,e){this._stateTrackers.dirtyStateTracker.setMutatedByAttributeName(t,e)}setFieldsDirty(t,e){this._stateTrackers.dirtyStateTracker.setMutatedByAttributeNames(t,e)}setDirtyAll(t){this._stateTrackers.dirtyStateTracker.setAll(t)}getFieldErrors(t){var e=this._stateTrackers.errorStateTracker.getMutatedByAttributeName(t);return r(e,(t=>t))}getFieldValid(t){var e;return(null!==(e=this._stateTrackers.errorStateTracker.getMutatedByAttributeName(t).length)&&void 0!==e?e:0)<=0}setErrorsAll(t){this.setErrorFlatList(t),this._stateTrackers.errorStateTracker.clear();var r=Object.groupBy(t,(({key:t})=>t));e(r,((t,e)=>{var r=(null==t?void 0:t.map((t=>t.message)))||[];this._stateTrackers.errorStateTracker.setMutatedByAttributeName(r,e)}))}isFormDirty(){return i(c(this._stateTrackers.dirtyStateTracker.state,"."),(t=>t.value))}isFormValid(){return!this.errorFlatList.length}getFieldState(t,e,r){var i=this._stateTrackers.errorStateTracker.getMutatedByAttributeName(t);return{name:t,currentValue:e,previousValue:r,touched:this._stateTrackers.touchedStateTracker.getMutatedByAttributeName(t),dirty:this._stateTrackers.dirtyStateTracker.getMutatedByAttributeName(t),isValid:!!i.length,errors:i}}}function l(e,r){const i=t.useRef(new n(e,r)).current,[,s]=t.useState(0);function a(){s((t=>t+1))}return{errorFlatList:i.errorFlatList,errors:i.errors,touched:i.touched,dirty:i.dirty,getFieldState:function(t,e,r){return i.getFieldState(t,e,r)},getFieldTouched:function(t){return i.getFieldTouched(t)},setFieldTouched:function(t,e){i.setFieldTouched(t,e),a()},setFieldsTouched:function(t,e){i.setFieldsTouched(t,e),a()},setTouchedAll:function(t){i.setTouchedAll(t),a()},getFieldDirty:function(t){return i.getFieldDirty(t)},setFieldDirty:function(t,e){i.setFieldDirty(t,e),a()},setFieldsDirty:function(t,e){i.setFieldsDirty(t,e),a()},setDirtyAll:function(t){i.setDirtyAll(t),a()},getFieldValid:function(t){return i.getFieldValid(t)},getFieldErrors:function(t){return i.getFieldErrors(t)},setErrorsAll:function(t){i.setErrorsAll(t),a()},isFormDirty:function(){return i.isFormDirty()},isFormValid:function(){return i.isFormValid()}}}function d(e,r,i){const[s,a]=t.useState(!1),{errorFlatList:o,errors:c,touched:n,dirty:d,getFieldTouched:h,setFieldTouched:T,setFieldsTouched:F,setTouchedAll:y,getFieldDirty:k,setFieldDirty:f,setFieldsDirty:g,setDirtyAll:S,getFieldValid:m,getFieldErrors:A,setErrorsAll:_,getFieldState:D,isFormDirty:b,isFormValid:p}=l(r,i);function v(){var t=!1;return(()=>{u(this,void 0,void 0,(function*(){return yield M().then((e=>t=e)).catch((()=>t=!1))}))})(),t}function M(){return e.validate(r).then((t=>(_(t),p())))}return t.useEffect((()=>{v()}),[]),{errorFlatList:o,errors:c,touched:n,dirty:d,isSubmitting:s,isFormDirty:b,isFormValid:p,validateAsync:M,validate:v,setIsSubmitting:function(t){a(t)},getFieldState:D,getFieldTouched:h,setFieldTouched:T,setFieldsTouched:F,setTouchedAll:y,getFieldDirty:k,setFieldDirty:f,setFieldsDirty:g,setDirtyAll:S,getFieldValid:m,getFieldErrors:A}}const h=d;exports.FormStateTrackers=o,exports.FormStateValidation=n,exports.flattenObject=function(t,e){return function t(e,r="",i="."){const s={};for(const u in e)if(e.hasOwnProperty(u)){const o=r?r+i+u:u;a.isObject(e[u])&&null!==e[u]?Object.assign(s,t(e[u],o,i)):s[o]=e[u]}return s}(t,"",e)},exports.flattenObjectToArray=c,exports.getDeep=function(t,e){return s.getAttributeMutation(t,e)},exports.setDeep=function(t,e,r){return s.setAttributeMutated(t,e,r)},exports.useFormFieldState=l,exports.useFormValidation=d,exports.useMabel=h;
//# sourceMappingURL=index.js.map
