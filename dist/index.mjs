import{useRef as t,useState as e,useEffect as r}from"react";import i from"lodash-es/forEach";import s from"lodash-es/map";import a from"lodash-es/some";import{MutationTracker as o,getAttributeMutation as u,setAttributeMutated as n}from"mutation-tracker";import{isObject as c}from"lodash-es";function l(t,e,r,i){return new(r||(r=Promise))((function(s,a){function o(t){try{n(i.next(t))}catch(t){a(t)}}function u(t){try{n(i.throw(t))}catch(t){a(t)}}function n(t){var e;t.done?s(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}n((i=i.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class d{get touchedStateTracker(){return this._touchedStateTracker}get dirtyStateTracker(){return this._dirtyStateTracker}get errorStateTracker(){return this._errorStateTracker}constructor(t,e){this._touchedStateTracker=o(t,{defaultValue:!1,initialMutation:{mutatedAttributes:null==e?void 0:e.initiallyTouched,mutatedValue:!0}}),this._dirtyStateTracker=o(t,{defaultValue:!1,initialMutation:{mutatedAttributes:null==e?void 0:e.initiallyDirty,mutatedValue:!0}}),this._errorStateTracker=o(t,{defaultValue:[]})}}function h(t,e){return u(t,e)}function T(t,e,r){return n(t,e,r)}function y(t,e){return function t(e,r="",i="."){const s={};for(const a in e)if(e.hasOwnProperty(a)){const o=r?r+i+a:a;c(e[a])&&null!==e[a]?Object.assign(s,t(e[a],o,i)):s[o]=e[a]}return s}(t,"",e)}function F(t,e){const r=[];return function t(e,i="",s="."){for(const a in e)if(e.hasOwnProperty(a)){const o=i?`${i}.${a}`:a;c(e[a])&&null!==e[a]?t(e[a],o,s):r.push({key:o,value:e[a]})}}(t,"",e),r}class k{constructor(t,e){this._errorFlatList=[],this._stateTrackers=new d(t,e)}get errorFlatList(){return this._errorFlatList}get errors(){return this._stateTrackers.errorStateTracker.state||{}}get touched(){return this._stateTrackers.errorStateTracker.state||{}}get dirty(){return this._stateTrackers.errorStateTracker.state||{}}setErrorFlatList(t){this._errorFlatList=t}getFieldTouched(t){return this._stateTrackers.touchedStateTracker.getMutatedByAttributeName(t)}setFieldTouched(t,e){this._stateTrackers.touchedStateTracker.setMutatedByAttributeName(t,e)}setFieldsTouched(t,e){this._stateTrackers.touchedStateTracker.setMutatedByAttributeNames(t,e)}setTouchedAll(t){this._stateTrackers.touchedStateTracker.setAll(t)}getFieldDirty(t){return this._stateTrackers.dirtyStateTracker.getMutatedByAttributeName(t)}setFieldDirty(t,e){this._stateTrackers.dirtyStateTracker.setMutatedByAttributeName(t,e)}setFieldsDirty(t,e){this._stateTrackers.dirtyStateTracker.setMutatedByAttributeNames(t,e)}setDirtyAll(t){this._stateTrackers.dirtyStateTracker.setAll(t)}getFieldErrors(t){var e=this._stateTrackers.errorStateTracker.getMutatedByAttributeName(t);return s(e,(t=>t))}getFieldValid(t){var e;return(null!==(e=this._stateTrackers.errorStateTracker.getMutatedByAttributeName(t).length)&&void 0!==e?e:0)<=0}setErrorsAll(t){this.setErrorFlatList(t),this._stateTrackers.errorStateTracker.clear();var e=Object.groupBy(t,(({key:t})=>t));i(e,((t,e)=>{var r=(null==t?void 0:t.map((t=>t.message)))||[];this._stateTrackers.errorStateTracker.setMutatedByAttributeName(r,e)}))}isFormDirty(){return a(F(this._stateTrackers.dirtyStateTracker.state,"."),(t=>t.value))}isFormValid(){return!this.errorFlatList.length}getFieldState(t,e,r){var i=this._stateTrackers.errorStateTracker.getMutatedByAttributeName(t);return{name:t,currentValue:e,previousValue:r,touched:this._stateTrackers.touchedStateTracker.getMutatedByAttributeName(t),dirty:this._stateTrackers.dirtyStateTracker.getMutatedByAttributeName(t),isValid:!!i.length,errors:i}}}function f(r,i){const s=t(new k(r,i)).current,[,a]=e(0);function o(){a((t=>t+1))}return{errorFlatList:s.errorFlatList,errors:s.errors,touched:s.touched,dirty:s.dirty,getFieldState:function(t,e,r){return s.getFieldState(t,e,r)},getFieldTouched:function(t){return s.getFieldTouched(t)},setFieldTouched:function(t,e){s.setFieldTouched(t,e),o()},setFieldsTouched:function(t,e){s.setFieldsTouched(t,e),o()},setTouchedAll:function(t){s.setTouchedAll(t),o()},getFieldDirty:function(t){return s.getFieldDirty(t)},setFieldDirty:function(t,e){s.setFieldDirty(t,e),o()},setFieldsDirty:function(t,e){s.setFieldsDirty(t,e),o()},setDirtyAll:function(t){s.setDirtyAll(t),o()},getFieldValid:function(t){return s.getFieldValid(t)},getFieldErrors:function(t){return s.getFieldErrors(t)},setErrorsAll:function(t){s.setErrorsAll(t),o()},isFormDirty:function(){return s.isFormDirty()},isFormValid:function(){return s.isFormValid()}}}function g(t,i,s){const[a,o]=e(!1),{errorFlatList:u,errors:n,touched:c,dirty:d,getFieldTouched:h,setFieldTouched:T,setFieldsTouched:y,setTouchedAll:F,getFieldDirty:k,setFieldDirty:g,setFieldsDirty:m,setDirtyAll:S,getFieldValid:A,getFieldErrors:_,setErrorsAll:D,getFieldState:p,isFormDirty:v,isFormValid:b}=f(i,s);function V(){var t=!1;return(()=>{l(this,void 0,void 0,(function*(){return yield E().then((e=>t=e)).catch((()=>t=!1))}))})(),t}function E(){return t.validate(i).then((t=>(D(t),b())))}return r((()=>{V()}),[]),{errorFlatList:u,errors:n,touched:c,dirty:d,isSubmitting:a,isFormDirty:v,isFormValid:b,validateAsync:E,validate:V,setIsSubmitting:function(t){o(t)},getFieldState:p,getFieldTouched:h,setFieldTouched:T,setFieldsTouched:y,setTouchedAll:F,getFieldDirty:k,setFieldDirty:g,setFieldsDirty:m,setDirtyAll:S,getFieldValid:A,getFieldErrors:_}}const m=g;export{d as FormStateTrackers,k as FormStateValidation,y as flattenObject,F as flattenObjectToArray,h as getDeep,T as setDeep,f as useFormFieldState,g as useFormValidation,m as useMabel};
//# sourceMappingURL=index.mjs.map
