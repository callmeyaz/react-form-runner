import{useRef as t,useState as e,useEffect as r}from"react";import{MutationTracker as i,getAttributeMutation as a,setAttributeMutated as s}from"mutation-tracker";import o from"lodash-es/forEach";import u from"lodash-es/map";import c from"lodash-es/some";import n from"lodash-es/isArray";import l from"lodash-es/isObject";function d(t,e,r,i){return new(r||(r=Promise))((function(a,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function u(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}c((i=i.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class h{_touchedStateTracker;_dirtyStateTracker;_errorStateTracker;get touchedStateTracker(){return this._touchedStateTracker}get dirtyStateTracker(){return this._dirtyStateTracker}get errorStateTracker(){return this._errorStateTracker}constructor(t,e){this._touchedStateTracker=i(t,{defaultValue:!1,initialMutation:{mutatedAttributes:e?.initiallyTouched,mutatedValue:!0}}),this._dirtyStateTracker=i(t,{defaultValue:!1,initialMutation:{mutatedAttributes:e?.initiallyDirty,mutatedValue:!0}}),this._errorStateTracker=i(t,{defaultValue:[]})}}class y{validator;_stateTrackers;_errorFlatList=[];constructor(t,e,r){this.validator=t,this._stateTrackers=new h(e,r)}get errorFlatList(){return this._errorFlatList}get errors(){return this._stateTrackers.errorStateTracker.state||{}}get touched(){return this._stateTrackers.touchedStateTracker.state||{}}get dirty(){return this._stateTrackers.dirtyStateTracker.state||{}}setErrorFlatList(t){this._errorFlatList=t}getFieldTouched(t){return this._stateTrackers.touchedStateTracker.getMutatedByAttributeName(t)}setFieldTouched(t,e){this._stateTrackers.touchedStateTracker.setMutatedByAttributeName(t,e)}setFieldsTouched(t,e){this._stateTrackers.touchedStateTracker.setMutatedByAttributeNames(t,e)}setTouchedAll(t){this._stateTrackers.touchedStateTracker.setAll(t)}getFieldDirty(t){return this._stateTrackers.dirtyStateTracker.getMutatedByAttributeName(t)}setFieldDirty(t,e){this._stateTrackers.dirtyStateTracker.setMutatedByAttributeName(t,e)}setFieldsDirty(t,e){this._stateTrackers.dirtyStateTracker.setMutatedByAttributeNames(t,e)}setDirtyAll(t){this._stateTrackers.dirtyStateTracker.setAll(t)}getFieldErrors(t){var e=this._stateTrackers.errorStateTracker.getMutatedByAttributeName(t);return u(e,(t=>t))}getFieldValid(t){return(this._stateTrackers.errorStateTracker.getMutatedByAttributeName(t).length??0)<=0}setErrorsAll(t){this.setErrorFlatList(t),this._stateTrackers.errorStateTracker.clear();var e=Object.groupBy(t,(({key:t})=>t));o(e,((t,e)=>{var r=t?.map((t=>t.message))||[];this._stateTrackers.errorStateTracker.setMutatedByAttributeName(r,e)}))}isFormDirty(){return c(function(t,e){const r=[];return function t(e,i="",a="."){for(const s in e)if(e.hasOwnProperty(s)){const o=i?`${i}.${s}`:s;l(e[s])&&null!==e[s]?t(e[s],o,a):r.push({key:o,value:e[s]})}}(t,"",e),r}(this._stateTrackers.dirtyStateTracker.state,"."),(t=>t.value))}isFormValid(){return!this.errorFlatList.length}getFieldState(t,e,r){var i=this._stateTrackers.errorStateTracker.getMutatedByAttributeName(t);return{name:t,currentValue:e,previousValue:r,touched:this._stateTrackers.touchedStateTracker.getMutatedByAttributeName(t),dirty:this._stateTrackers.dirtyStateTracker.getMutatedByAttributeName(t),isValid:!!i.length,errors:i}}validateAsync(t){return this.validator.validate(t).then((t=>(this.setErrorsAll(t),this.isFormValid())))}}function T(r,i,a){const s=t(new y(r,i,a)).current,[,o]=e(0);function u(){o((t=>t+1))}return{errorFlatList:s.errorFlatList,errors:s.errors,touched:s.touched,dirty:s.dirty,getFieldState:function(t,e,r){return s.getFieldState(t,e,r)},getFieldTouched:function(t){return s.getFieldTouched(t)},setFieldTouched:function(t,e){s.setFieldTouched(t,e),u()},setFieldsTouched:function(t,e){s.setFieldsTouched(t,e),u()},setTouchedAll:function(t){s.setTouchedAll(t),u()},getFieldDirty:function(t){return s.getFieldDirty(t)},setFieldDirty:function(t,e){s.setFieldDirty(t,e),u()},setFieldsDirty:function(t,e){s.setFieldsDirty(t,e),u()},setDirtyAll:function(t){s.setDirtyAll(t),u()},getFieldValid:function(t){return s.getFieldValid(t)},getFieldErrors:function(t){return s.getFieldErrors(t)},setErrorsAll:function(t){s.setErrorsAll(t),u()},isFormDirty:function(){return s.isFormDirty()},isFormValid:function(){return s.isFormValid()},validateAsync:s.validateAsync}}function F(t,i,a){const[s,o]=e(!1),{errorFlatList:u,errors:c,touched:n,dirty:l,getFieldTouched:h,setFieldTouched:y,setFieldsTouched:F,setTouchedAll:f,getFieldDirty:k,setFieldDirty:m,setFieldsDirty:g,setDirtyAll:S,getFieldValid:A,getFieldErrors:_,setErrorsAll:D,getFieldState:p,isFormDirty:v,isFormValid:b,validateAsync:V}=T(t,i,a);function E(){var t=!1;return(()=>{d(this,void 0,void 0,(function*(){return yield V(i).then((e=>t=e)).catch((()=>t=!1))}))})(),t}return r((()=>{E()}),[]),{errorFlatList:u,errors:c,touched:n,dirty:l,isSubmitting:s,isFormDirty:v,isFormValid:b,validateAsync:V,validate:E,setIsSubmitting:function(t){o(t)},getFieldState:p,getFieldTouched:h,setFieldTouched:y,setFieldsTouched:F,setTouchedAll:f,getFieldDirty:k,setFieldDirty:m,setFieldsDirty:g,setDirtyAll:S,getFieldValid:A,getFieldErrors:_}}const f=F;function k(t,e){return a(t,e)}function m(t,e,r){return s(t,e,r)}function g(t,e){return function t(e,r="",i="."){const a={};for(const s in e)if(e.hasOwnProperty(s)){const o=r?r+i+s:s;l(e[s])&&null!==e[s]?Object.assign(a,t(e[s],o,i)):a[o]=e[s]}return a}(t,"",e)}function S(t,e){const r=[];return function t(e,i="",a="."){for(const s in e)if(e.hasOwnProperty(s)){const o=i?`${i}.${s}`:s;l(e[s])&&null!==e[s]?t(e[s],o,a):r.push({key:o,value:e[s]})}}(t,"",e),r}function A(t){Object.freeze(t);for(const e in t)l(t[e]||n(t[e]))&&A(t[e]);return t}export{A as deepFreeze,g as flattenObject,S as flattenObjectToArray,k as getDeep,m as setDeep,T as useFormFieldState,F as useFormValidation,f as useMabel};
//# sourceMappingURL=index.mjs.map
